<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <!-- ‚úÖ viewport limpio (sin bloquear zoom, evita bugs raros de ‚Äúacercado‚Äù) -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Para Monica Patricia üíå</title>
  <meta name="theme-color" content="#120013" />

  <style>
    :root{
      --bgA: radial-gradient(circle at center, #3b0a1e, #120013);
      --bgB: radial-gradient(circle at 30% 20%, #2b0014, #120013 55%, #050006);
      --bgC: radial-gradient(circle at 40% 25%, #6b0f2c, #170014 55%, #030003);
      --paper: #fdf5e6;
      --ink: #3b2b20;

      /* ‚úÖ fallback si JS a√∫n no setea --vh */
      --vh: 1vh;
    }

    html{
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }

    body{
      margin:0;
      min-height: calc(var(--vh) * 100); /* ‚úÖ fix m√≥vil (evita ‚Äúzoom‚Äù raro) */
      overflow:hidden;
      display:flex; align-items:center; justify-content:center;
      background: var(--bgA);
      color:#fff; font-family:"Georgia", serif;
      transition: background 1.2s ease;
    }

    .wrapper{ text-align:center; position:relative; width:min(980px, 94vw); padding:14px; }

    .envelope-area{ position:relative; width:360px; height:250px; margin:0 auto; transform: translateZ(0); }
    .envelope{
      width:100%; height:100%;
      background:#e7c39c; border-radius:10px;
      box-shadow:0 22px 70px rgba(0,0,0,.55);
      position:absolute; left:0; top:0;
    }
    .flap{
      position:absolute; left:0; top:0; width:100%; height:100%;
      background:#d9b184;
      clip-path: polygon(0 0, 50% 62%, 100% 0);
      transform-origin: top;
      transition: transform 1.35s ease;
      border-radius:10px;
    }
    .seal{
      position:absolute; left:50%; top:56%;
      transform:translate(-50%,-50%);
      width:58px; height:58px; border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #ff7aa2, #b1002f 70%);
      box-shadow: 0 14px 30px rgba(0,0,0,.35);
      display:flex; align-items:center; justify-content:center;
      font-size:26px; user-select:none;
    }

    .stamp-text{
      position:absolute; left:50%; top:16%; transform:translateX(-50%);
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.18);
      padding:8px 12px; border-radius:999px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight:800; font-size:13px; letter-spacing:.2px;
      display:none;
    }

    /* CARTA */
    .letter{
      position:absolute; left:50%; top:0;
      transform: translate(-50%, 160%);
      width: min(860px, 92vw);
      max-height: min(78vh, 740px);
      overflow:auto;
      padding: 22px 18px;
      background: var(--paper); color: var(--ink);
      border-radius:14px;
      box-shadow:0 28px 90px rgba(0,0,0,.70);
      line-height:1.75;
      text-align:center;
      transition: transform 1.55s ease;
      background-image: url("https://www.transparenttextures.com/patterns/old-paper.png");
      border: 1px solid rgba(0,0,0,.10);
      -webkit-overflow-scrolling: touch;
    }
    .letter h2{ margin:0 0 10px; font-size:22px; }
    .letter p{ margin:10px 0; }

    .signature{ margin-top:16px; font-weight:900; }
    .sigline{ margin-top:6px; font-style:italic; opacity:.92; }

    /* Modo ‚Äúsobre‚Äù */
    .open .flap{ transform: rotateX(180deg); }
    .open:not(.fullscreen) .letter{ transform: translate(-50%, -152%); }

    .section{ margin: 14px auto; width: min(820px, 100%); }
    .quote{
      margin: 10px auto 0;
      padding: 14px 14px;
      border-radius: 14px;
      background: rgba(0,0,0,.06);
      border: 1px solid rgba(0,0,0,.08);
      font-size: 16px;
    }

    /* T√≠tulo grande M&M */
    .mm-title{
      margin: 12px 0 10px;
      font-size: clamp(34px, 6vw, 56px);
      font-weight: 900;
      letter-spacing: 2px;
      line-height: 1;
      color: #2b0014;
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
    }

    /* Video */
    .video{
      width: 100%;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(0,0,0,.10);
      background: #000;
      box-shadow: 0 10px 30px rgba(0,0,0,.18);
    }
    .video video{ width:100%; display:block; }

    /* Galer√≠a */
    .gallery{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    @media (max-width: 740px){
      .gallery{ grid-template-columns: repeat(2, 1fr); }
    }
    .ph{
      position:relative;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(0,0,0,.04);
      cursor: pointer;
    }
    .ph img{
      width:100%;
      height: 180px;
      object-fit: cover;
      display:block;
      transition: transform .35s ease;
    }
    .ph:hover img{ transform: scale(1.04); }

    /* Lightbox */
    .lightbox{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.78);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:99;
      padding: 18px;
    }
    .lightbox.open{ display:flex; }
    .lightbox img{
      max-width: min(980px, 92vw);
      max-height: 86vh;
      border-radius: 16px;
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
    }

    .panel{
      margin-top:20px;
      display:flex; gap:12px; flex-wrap:wrap; justify-content:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .pill{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      padding: 10px 12px; border-radius: 999px;
      font-size:13px; color: rgba(255,255,255,.92);
      user-select:none;
    }

    .btn{
      border:0; padding:11px 14px; border-radius:999px;
      font-weight:900; cursor:pointer;
      background: linear-gradient(135deg,#ff2e63,#ff7aa2);
      color:#fff; box-shadow: 0 16px 40px rgba(255,46,99,.22);
    }

    .overlay{
      position:fixed; inset:0; z-index:50; display:none; place-items:center;
      background: rgba(0,0,0,.70); backdrop-filter: blur(10px); padding:18px;
    }
    .overlay .box{
      width:min(560px, 92vw);
      background: rgba(18,0,19,.92);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 22px;
      box-shadow: 0 22px 70px rgba(0,0,0,.55);
      padding: 18px; text-align:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .overlay .title{ font-size:18px; font-weight:900; margin-bottom:8px; }
    .overlay .text{ color: rgba(255,255,255,.80); line-height:1.6; margin-bottom:14px; font-size:14px; }
    .overlay .btn{ width:100%; }

    .petal{
      position:absolute; top:-30px; font-size:18px;
      animation: fall linear forwards; pointer-events:none;
      filter: drop-shadow(0 8px 16px rgba(0,0,0,.35));
    }
    @keyframes fall{ to{ transform: translateY(112vh) rotate(360deg); opacity:0; } }

    .sparkle{
      position:absolute; top:-20px; font-size:16px;
      animation: sparkleFall linear forwards; pointer-events:none;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
    }
    @keyframes sparkleFall{ to{ transform: translateY(112vh) rotate(720deg); opacity:0; } }

    .nudge{ animation: nudge 0.8s ease; }
    @keyframes nudge{
      0%{ transform: translateY(0) rotate(0); }
      20%{ transform: translateY(-4px) rotate(-1deg); }
      40%{ transform: translateY(2px) rotate(1deg); }
      60%{ transform: translateY(-3px) rotate(-1deg); }
      80%{ transform: translateY(2px) rotate(1deg); }
      100%{ transform: translateY(0) rotate(0); }
    }

    #ytwrap{position:absolute; left:-9999px; top:-9999px; width:1px; height:1px; overflow:hidden;}

    /* ====== FULLSCREEN FINAL (M√ìVIL FRIENDLY) ====== */
    .fullscreen{
      width: 100vw !important;
      padding: 0 !important;
    }

    .fullscreen .envelope-area{
      width: 100vw;
      height: calc(var(--vh) * 100); /* ‚úÖ */
      margin: 0;
    }

    .fullscreen .envelope,
    .fullscreen .flap,
    .fullscreen .seal,
    .fullscreen .stamp-text{
      display: none !important;
    }

    .fullscreen .letter{
      position: fixed;
      inset: 0;
      width: 100vw;
      height: calc(var(--vh) * 100); /* ‚úÖ */
      max-height: none;

      transform: translateY(110%);
      border-radius: 0;

      padding-top: calc(18px + env(safe-area-inset-top));
      padding-right: 14px;
      padding-left: 14px;
      padding-bottom: calc(26px + env(safe-area-inset-bottom));

      overflow: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }

    .fullscreen.open .letter{ transform: translateY(0); }

    /* ‚úÖ Ajustes finos para M√ìVIL */
    @media (max-width: 520px){
      .letter{
        line-height: 1.65;
        font-size: 16px; /* ‚úÖ evita auto-zoom */
      }
      .letter h2{ font-size: 20px; }
      .quote{ font-size: 15px; padding: 12px; }

      .mm-title{
        font-size: clamp(34px, 10vw, 52px);
        margin: 10px 0 6px;
      }

      .gallery{
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .ph img{
        height: auto;
        aspect-ratio: 1 / 1;
        object-fit: cover;
      }
    }

    @media (max-width: 360px){
      .gallery{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
<div id="ytwrap"><div id="ytplayer"></div></div>

<div class="wrapper" id="wrapper">
  <div class="envelope-area" id="envelopeArea">
    <div class="envelope"></div>
    <div class="flap"></div>
    <div class="stamp-text" id="stampText">¬øEst√°s lista? ¬øMe amas? üíñ</div>
    <div class="seal">üíå</div>

    <div class="letter" id="letter">
      <h2>Para Monica Patricia üíñ</h2>

      <div class="section quote" id="loveText"></div>

      <div class="section">
        <div class="mm-title">M&amp;M</div>
      </div>

      <div class="section">
        <h3 style="margin:10px 0 10px;">Nosotros üì∏</h3>
        <div class="gallery" id="gallery"></div>
      </div>

      <div class="section">
        <h3 style="margin:14px 0 10px;">¬°Por m√°s 14 de febrero juntos! üé•</h3>
        <div class="video">
          <video id="loveVideo" controls playsinline preload="metadata"></video>
        </div>
        <div style="font-size:13px;opacity:.8;margin-top:8px;">
          Mereces esto y mucho m√°s, hermosa mujer.
        </div>
      </div>

      <div class="signature" id="signature"></div>
      <div class="sigline">‚Äî Michael Gonzales, tu futuro esposo. üíç‚ù§Ô∏è</div>
    </div>
  </div>

  <div class="panel">
    <div class="pill" id="statusPill">üíå Carta sellada</div>
    <div class="pill" id="countPill">‚è≥ ‚Ä¶</div>
    <button class="btn" id="musicBtn" style="display:none;">üéµ Reproducir</button>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="box">
    <div class="title" id="overlayTitle">üíñ</div>
    <div class="text" id="overlayText">Toca para continuar.</div>
    <button class="btn" id="overlayBtn">Entrar ‚ú®</button>
  </div>
</div>

<div class="lightbox" id="lightbox">
  <img id="lightboxImg" alt="foto" />
</div>

<script>
  (() => {
    // ‚úÖ Fix 100vh m√≥vil (evita ‚Äúacercado‚Äù raro)
    function setVh(){
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    setVh();
    window.addEventListener('resize', setVh);
    window.addEventListener('orientationchange', setVh);

    // ========= CONFIG =========
    const NAME = "M√≥nica Patricia";
    const YT_VIDEO_ID = "Vk-A6jLTOmM"; // tu canci√≥n (YouTube oculto)

    const VIDEO_SRC = "assets/video.mp4";
    const VIDEO_POSTER = "";

    const ASSET_PHOTOS = [
      "assets/foto1.jpg",
      "assets/foto2.jpg",
      "assets/foto3.jpg",
      "assets/foto4.jpg",
      "assets/foto5.jpg",
      "assets/foto6.jpg",
      "assets/foto7.jpg",
      "assets/foto8.jpg",
      "assets/foto9.jpg",
      "assets/foto10.jpg",
      "assets/foto11.jpg",
      "assets/foto12.jpg",
      "assets/foto13.jpg",
      "assets/foto14.jpg",
      "assets/foto15.jpg",
    ];

    const LOVE_MESSAGE = `
      Eres mi persona favorita, eres mi princesa y m√°s hermosa que todas las de Disney, la mujer de mis oraciones,
      definitivamente la mujer de mis sue√±os. Qui√©n dir√≠a que nuestras almas se conocer√≠an y encajar√≠an tan perfecto.
      Hace un a√±o ni me imaginaba estar as√≠ de enamorado. Cada d√≠a, desde que te conoc√≠, me enamoro m√°s y m√°s, y s√© que este amor apenas empieza.
      <br><br>
      La distancia tan solo es una piedra fea del camino, pero nuestro amor tiene unas grandes llantas
      de tractor que les pasar√° encima a cada piedra fea y odiosa.
      <br><br>
      Te amo, Monica Patricia. üíñ
    `;

    // ========= ELEMENTOS =========
    const wrapper = document.getElementById("wrapper");
    const envelopeArea = document.getElementById("envelopeArea");
    const stampText = document.getElementById("stampText");
    const statusPill = document.getElementById("statusPill");
    const countPill = document.getElementById("countPill");
    const overlay = document.getElementById("overlay");
    const overlayTitle = document.getElementById("overlayTitle");
    const overlayText = document.getElementById("overlayText");
    const overlayBtn = document.getElementById("overlayBtn");
    const musicBtn = document.getElementById("musicBtn");
    const signature = document.getElementById("signature");

    const loveText = document.getElementById("loveText");
    const loveVideo = document.getElementById("loveVideo");
    const gallery = document.getElementById("gallery");

    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightboxImg");

    signature.textContent = `Te amo, ${NAME}.`;
    loveText.innerHTML = LOVE_MESSAGE;

    loveVideo.src = VIDEO_SRC;
    if (VIDEO_POSTER) loveVideo.poster = VIDEO_POSTER;

    function buildGallery(){
      gallery.innerHTML = "";
      for(const src of ASSET_PHOTOS){
        const box = document.createElement("div");
        box.className = "ph";
        const img = document.createElement("img");
        img.loading = "lazy";
        img.src = src;
        img.alt = "recuerdo";
        box.appendChild(img);

        box.addEventListener("click", () => {
          lightboxImg.src = src;
          lightbox.classList.add("open");
        });

        gallery.appendChild(box);
      }
    }
    buildGallery();
    lightbox.addEventListener("click", () => lightbox.classList.remove("open"));

    // ========= TIEMPO =========
    let secureBase = null;
    let secureBaseLocalTs = 0;

    async function tryFetchSecureTimeOnce(timeoutMs=1800){
      const ctrl = new AbortController();
      const t = setTimeout(() => ctrl.abort(), timeoutMs);

      const urls = [
        "https://timeapi.io/api/Time/current/zone?timeZone=America/Guatemala",
        "https://worldtimeapi.org/api/timezone/America/Guatemala"
      ];

      for(const url of urls){
        try{
          const res = await fetch(url, { cache:"no-store", signal: ctrl.signal });
          const data = await res.json();
          clearTimeout(t);

          const dt = data.dateTime ? new Date(data.dateTime) : new Date(data.datetime);
          if(!isNaN(dt.getTime())){
            secureBase = dt;
            secureBaseLocalTs = Date.now();
            return true;
          }
        }catch(e){}
      }
      clearTimeout(t);
      return false;
    }

    function nowGT(){
      if(secureBase){
        const drift = Date.now() - secureBaseLocalTs;
        return new Date(secureBase.getTime() + drift);
      }
      return new Date();
    }

    tryFetchSecureTimeOnce();
    setInterval(() => { tryFetchSecureTimeOnce(); }, 60000);

    // ========= FECHAS =========
    function makeTargets(n){
      const y = n.getFullYear();
      const teaser  = new Date(y, 1, 13, 15, 0, 0);
      const final   = new Date(y, 1, 14, 0, 0, 0);
      const preOpen = new Date(y, 1, 14, 14, 20, 0);

      if(n > preOpen){
        teaser.setFullYear(y + 1);
        final.setFullYear(y + 1);
        preOpen.setFullYear(y + 1);
      }
      return { teaser, final, preOpen };
    }

    function fmtCountdown(ms){
      const s = Math.max(0, Math.floor(ms/1000));
      const hh = Math.floor(s/3600);
      const mm = Math.floor((s%3600)/60);
      const ss = s%60;
      return `${hh}h ${mm}m ${ss}s`;
    }

    function setBackground(mode){
      const root = getComputedStyle(document.documentElement);
      if(mode === "locked") document.body.style.background = root.getPropertyValue("--bgA");
      if(mode === "teaser") document.body.style.background = root.getPropertyValue("--bgB");
      if(mode === "final")  document.body.style.background = root.getPropertyValue("--bgC");
    }

    // ========= P√âTALOS / BRILLOS =========
    let petalsTimer = null;
    function startPetals(){
      if(petalsTimer) return;
      petalsTimer = setInterval(() => {
        const p = document.createElement("div");
        p.className = "petal";
        p.textContent = Math.random() > 0.35 ? "üåπ" : "üíñ";
        p.style.left = (Math.random()*100) + "vw";
        p.style.fontSize = (14 + Math.random()*14) + "px";
        p.style.animationDuration = (5 + Math.random()*6) + "s";
        document.body.appendChild(p);
        setTimeout(() => p.remove(), 12000);
      }, 220);
    }

    let sparkleTimer = null;
    function startSparkles(){
      if(sparkleTimer) return;
      sparkleTimer = setInterval(() => {
        const sp = document.createElement("div");
        sp.className = "sparkle";
        sp.textContent = Math.random() > 0.5 ? "‚ú®" : "üíñ";
        sp.style.left = (Math.random()*100) + "vw";
        sp.style.fontSize = (12 + Math.random()*16) + "px";
        sp.style.animationDuration = (4 + Math.random()*5) + "s";
        document.body.appendChild(sp);
        setTimeout(() => sp.remove(), 10000);
      }, 180);
    }

    // ========= YOUTUBE (canci√≥n) =========
    let player = null;
    let isPlaying = false;
    let userGestureUnlocked = false;

    function loadYouTubeApi(){
      return new Promise((resolve) => {
        if(window.YT && window.YT.Player) return resolve();
        const tag = document.createElement("script");
        tag.src = "https://www.youtube.com/iframe_api";
        window.onYouTubeIframeAPIReady = () => resolve();
        document.head.appendChild(tag);
      });
    }

    async function initPlayer(){
      if(player) return;
      await loadYouTubeApi();
      player = new YT.Player("ytplayer", {
        height:"1", width:"1",
        videoId: YT_VIDEO_ID,
        playerVars: { autoplay: 0, controls: 0, rel: 0, modestbranding: 1 },
        events: {
          onReady: () => { try{ player.setVolume(0); }catch{} },
          onStateChange: (e) => {
            if(e.data === 1){ isPlaying = true; musicBtn.textContent = "‚è∏ Pausar"; }
            if(e.data === 2){ isPlaying = false; musicBtn.textContent = "üéµ Reproducir"; }
          }
        }
      });
    }

    async function playMusic(volume=70){
      await initPlayer();
      try{ player.setVolume(volume); player.playVideo(); isPlaying = true; }catch{}
    }
    async function pauseMusic(){
      if(!player) return;
      try{ player.pauseVideo(); }catch{}
    }

    musicBtn.addEventListener("click", async () => {
      userGestureUnlocked = true;
      await initPlayer();
      if(!isPlaying) await playMusic(70);
      else await pauseMusic();
    });

    // ========= OVERLAY =========
    function showOverlay(title, text, btnText="Entrar ‚ú®"){
      overlayTitle.textContent = title;
      overlayText.textContent = text;
      overlayBtn.textContent = btnText;
      overlay.style.display = "grid";
    }
    function hideOverlay(){ overlay.style.display = "none"; }

    overlayBtn.addEventListener("click", async () => {
      userGestureUnlocked = true;
      hideOverlay();
      await initPlayer();
      try{ player.setVolume(0); player.playVideo(); }catch{}
      musicBtn.style.display = "inline-block";
    });

    // ========= FASES =========
    let phase = "locked";

    function setPhase(newPhase){
      if(phase === newPhase) return;
      phase = newPhase;

      wrapper.classList.remove("fullscreen");
      wrapper.classList.remove("open");

      if(phase === "locked"){
        setBackground("locked");
        stampText.style.display = "none";
        musicBtn.style.display = "none";
        statusPill.textContent = "üíå Carta sellada";
      }

      if(phase === "teaser"){
        setBackground("teaser");
        stampText.style.display = "inline-flex";
        stampText.textContent = "¬øEst√°s lista? ¬øMe amas? üíñ";
        statusPill.textContent = "üåô ¬øEst√°s lista?";
        showOverlay("üíñ", "Toca para entrar‚Ä¶", "Entrar ‚ú®");
        musicBtn.style.display = "inline-block";
      }

      if(phase === "final"){
        setBackground("final");
        stampText.style.display = "none";
        statusPill.textContent = "üåπ 14 de febrero";

        wrapper.classList.add("fullscreen");
        wrapper.classList.add("open");

        requestAnimationFrame(() => {
          const letter = document.getElementById("letter");
          if(letter) letter.scrollTop = 0;
        });

        startPetals();

        if(userGestureUnlocked){
          playMusic(70);
          musicBtn.style.display = "inline-block";
        }else{
          showOverlay("üåπ", "Lo siento por la espera, con tu paciencia fue dif√≠cil...", "Abrir üíå");
        }
        countPill.textContent = "‚ú®";
      }

      if(phase === "preopen"){
        setBackground("final");
        stampText.style.display = "inline-flex";
        stampText.textContent = "Ya pronto, mi amor‚Ä¶ üíñ";
        statusPill.textContent = "‚ú® Ya casi‚Ä¶";
        musicBtn.style.display = "inline-block";

        wrapper.classList.add("open");
        setTimeout(()=> wrapper.classList.remove("open"), 1400);
        setTimeout(()=> wrapper.classList.add("open"), 2600);
        setTimeout(()=> wrapper.classList.remove("open"), 3800);

        startSparkles();
        countPill.textContent = "üíñ";
      }
    }

    envelopeArea.addEventListener("click", async () => {
      if(phase === "teaser"){
        wrapper.classList.remove("open");
        if(overlay.style.display === "grid") hideOverlay();

        envelopeArea.classList.remove("nudge");
        void envelopeArea.offsetWidth;
        envelopeArea.classList.add("nudge");

        userGestureUnlocked = true;
        musicBtn.style.display = "inline-block";
        await initPlayer();
        try{ player.setVolume(0); player.playVideo(); }catch{}
      }
    });

    // ========= LOOP =========
    let targets = null;
    function loop(){
      const qp = new URLSearchParams(location.search);
      const test = (qp.get("test") || "").toLowerCase();
      if (test) {
        if (test === "locked")  { setPhase("locked");  countPill.textContent = "üß™ Modo prueba: locked"; return; }
        if (test === "teaser")  { setPhase("teaser");  countPill.textContent = "üß™ Modo prueba: teaser"; return; }
        if (test === "final")   { setPhase("final");   countPill.textContent = "üß™ Modo prueba: final"; return; }
        if (test === "preopen") { setPhase("preopen"); countPill.textContent = "üß™ Modo prueba: preopen"; return; }
      }

      const n = nowGT();
      if(!targets) targets = makeTargets(n);
      const { teaser, final, preOpen } = targets;

      if(n < teaser){
        setPhase("locked");
        countPill.textContent = `‚è≥ ${fmtCountdown(teaser - n)} (para las 3:00 PM)`;
        return setTimeout(loop, 1000);
      }

      if(n >= teaser && n < final){
        setPhase("teaser");
        countPill.textContent = `‚è≥ ${fmtCountdown(final - n)} (para medianoche)`;
        return setTimeout(loop, 1000);
      }

      if(n >= final && n < preOpen){
        setPhase("final");
        return setTimeout(loop, 3000);
      }

      if(n >= preOpen){
        setPhase("preopen");
        return;
      }
    }

    setBackground("locked");
    loop();
  })();
</script>
</body>
</html>
